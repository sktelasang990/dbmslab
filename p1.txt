CREATE TABLE PUBLISHER (
    NAME VARCHAR(20) PRIMARY KEY,
    PHONE BIGINT,
    ADDRESS VARCHAR(20)
);

CREATE TABLE BOOK (
    BOOK_ID INTEGER PRIMARY KEY,
    TITLE VARCHAR(20),
    PUB_YEAR VARCHAR(20),
    PUBLISHER_NAME VARCHAR(20),
    FOREIGN KEY (PUBLISHER_NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE
);

CREATE TABLE BOOK_AUTHORS (
    AUTHOR_NAME VARCHAR(20),
    BOOK_ID INTEGER,
    PRIMARY KEY (BOOK_ID, AUTHOR_NAME),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE
);

CREATE TABLE LIBRARY_PROGRAMME (
    PROGRAMME_ID INTEGER PRIMARY KEY,
    PROGRAMME_NAME VARCHAR(50),
    ADDRESS VARCHAR(50)
);
CREATE TABLE BOOK_COPIES (
    NO_OF_COPIES INTEGER,
    BOOK_ID INTEGER,
    PROGRAMME_ID INTEGER,
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (PROGRAMME_ID) REFERENCES LIBRARY_PROGRAMME (PROGRAMME_ID) ON DELETE CASCADE,
    PRIMARY KEY (BOOK_ID, PROGRAMME_ID)
);

CREATE TABLE CARD (
    CARD_NO INTEGER PRIMARY KEY
);

CREATE TABLE BOOK_LENDING (
    DATE_OUT DATE,
    DUE_DATE DATE,
    BOOK_ID INTEGER,
    PROGRAMME_ID INTEGER,
    CARD_NO INTEGER,
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (PROGRAMME_ID) REFERENCES LIBRARY_PROGRAMME (PROGRAMME_ID) ON DELETE CASCADE,
    PRIMARY KEY (BOOK_ID, PROGRAMME_ID, CARD_NO)
);


INSERT INTO PUBLISHER VALUES('MCGRAW-HILL',9989076587,'BANGALORE');
INSERT INTO PUBLISHER VALUES('PEARSON', 9889076565,'NEWDELHI');
INSERT INTO PUBLISHER VALUES('RANDOM HOUSE',7455679345,'HYDRABAD');
INSERT INTO PUBLISHER VALUES('HACHETTE LIVRE',8970862340,'CHENAI');
INSERT INTO PUBLISHER VALUES('GRUPO PLANETA',7756120238,'BANGALORE');


INSERT INTO BOOK VALUES (1, 'DBMS', '2017-01-01', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (2, 'ADBMS', '2016-06-01', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (3, 'CN', '2016-09-01', 'PEARSON');
INSERT INTO BOOK VALUES (4, 'CG', '2015-09-01', 'GRUPO PLANETA');
INSERT INTO BOOK VALUES (5, 'OS', '2016-05-01', 'PEARSON');


INSERT INTO BOOK_AUTHORS VALUES ('NAVATHE', 1);
INSERT INTO BOOK_AUTHORS VALUES ('NAVATHE', 2);
INSERT INTO BOOK_AUTHORS VALUES ('TANENBAUM', 3);
INSERT INTO BOOK_AUTHORS VALUES ('EDWARD ANGEL', 4);
INSERT INTO BOOK_AUTHORS VALUES ('GALVIN', 5);


INSERT INTO LIBRARY_PROGRAMME VALUES(10,'RRNAGAR','BANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(11,'APSCE','BANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(12,'N R COLONY','BANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(13,'NITTE','MANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(14,'MANIPAL','UDUPI');

INSERT INTO BOOK_COPIES VALUES (10,1, 10);
INSERT INTO BOOK_COPIES VALUES (5,1, 11);
INSERT INTO BOOK_COPIES VALUES (2,2, 12);
INSERT INTO BOOK_COPIES VALUES (5,2, 13);
INSERT INTO BOOK_COPIES VALUES (7,3, 14);
INSERT INTO BOOK_COPIES VALUES (1,5, 10);
INSERT INTO BOOK_COPIES VALUES (3,4, 11);

INSERT INTO BOOK_LENDING VALUES ('2017-01-01', '2017-06-01', 1, 10, 101);
INSERT INTO BOOK_LENDING VALUES ('2017-01-11', '2017-03-11', 3, 14, 101);
INSERT INTO BOOK_LENDING VALUES ('2017-02-21', '2017-04-21', 2, 13, 101);
INSERT INTO BOOK_LENDING VALUES ('2017-03-15', '2017-07-15', 4, 11, 101);
INSERT INTO BOOK_LENDING VALUES ('2017-04-12', '2017-05-12', 1, 11, 104);

SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME,
C.NO_OF_COPIES, L.PROGRAMME_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_PROGRAMME L 
WHERE B.BOOK_ID=A.BOOK_ID
AND B.BOOK_ID=C.BOOK_ID
AND L.PROGRAMME_ID=C.PROGRAMME_ID;


SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-07-01'
GROUP BY CARD_NO
HAVING COUNT(*) > 3;

DELETE FROM BOOK
WHERE BOOK_ID=3;


CREATE VIEW V_PUBLICATION AS
SELECT PUB_YEAR
FROM BOOK;
SELECT * FROM V_PUBLICATION;



CREATE VIEW V_BOOKS AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM BOOK B, BOOK_COPIES C,
LIBRARY_PROGRAMME L
WHERE B.BOOK_ID=C.BOOK_ID AND
C.PROGRAMME_ID=L.PROGRAMME_ID;
